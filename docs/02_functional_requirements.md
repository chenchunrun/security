# åŠŸèƒ½éœ€æ±‚æ¸…å•

**ç‰ˆæœ¬**: v1.0
**æ—¥æœŸ**: 2025-01-05
**çŠ¶æ€**: è¯¦ç»†è®¾è®¡é˜¶æ®µ

---

## ğŸ“‹ ç›®å½•

- [1. åŠŸèƒ½ä¼˜å…ˆçº§è¯´æ˜](#1-åŠŸèƒ½ä¼˜å…ˆçº§è¯´æ˜)
- [2. M1 - å‘Šè­¦æ¥å…¥æ¨¡å—](#2-m1---å‘Šè­¦æ¥å…¥æ¨¡å—)
- [3. M2 - å¨èƒæƒ…æŠ¥æ¨¡å—](#3-m2---å¨èƒæƒ…æŠ¥æ¨¡å—)
- [4. M3 - ä¸Šä¸‹æ–‡å¢å¼ºæ¨¡å—](#4-m3---ä¸Šä¸‹æ–‡å¢å¼ºæ¨¡å—)
- [5. M4 - AIç ”åˆ¤æ¨¡å—](#5-m4---aiç ”åˆ¤æ¨¡å—)
- [6. M5 - å·¥ä½œæµç®¡ç†æ¨¡å—](#6-m5---å·¥ä½œæµç®¡ç†æ¨¡å—)
- [7. M6 - è‡ªåŠ¨å“åº”æ¨¡å—](#7-m6---è‡ªåŠ¨å“åº”æ¨¡å—)
- [8. M7 - é€šçŸ¥å‘Šè­¦æ¨¡å—](#8-m7---é€šçŸ¥å‘Šè­¦æ¨¡å—)
- [9. M8 - å¯è§†åŒ–ä¸æŠ¥è¡¨](#9-m8---å¯è§†åŒ–ä¸æŠ¥è¡¨)
- [10. M9 - ç³»ç»Ÿç®¡ç†æ¨¡å—](#10-m9---ç³»ç»Ÿç®¡ç†æ¨¡å—)
- [11. M10 - ç›‘æ§è¿ç»´æ¨¡å—](#11-m10---ç›‘æ§è¿ç»´æ¨¡å—)

---

## 1. åŠŸèƒ½ä¼˜å…ˆçº§è¯´æ˜

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ä¼˜å…ˆçº§å®šä¹‰                                                            â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                                                      â”ƒ
â”ƒ  ğŸ”´ P0 (MVPå¿…å¤‡)                                                       â”ƒ
â”ƒ     â€¢ ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»æœ‰                                             â”ƒ
â”ƒ     â€¢ å½±å“åŸºæœ¬å¯ç”¨æ€§                                                  â”ƒ
â”ƒ     â€¢ ç¼ºå°‘åˆ™æ— æ³•ä¸Šçº¿                                                  â”ƒ
â”ƒ                                                                      â”ƒ
â”ƒ  ğŸŸ¡ P1 (é‡è¦)                                                          â”ƒ
â”ƒ     â€¢ æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒ                                                â”ƒ
â”ƒ     â€¢ ç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®                                                â”ƒ
â”ƒ     â€¢ v1.0ç‰ˆæœ¬åº”åŒ…å«                                                  â”ƒ
â”ƒ                                                                      â”ƒ
â”ƒ  ğŸŸ¢ P2 (å¯é€‰)                                                          â”ƒ
â”ƒ     â€¢ é”¦ä¸Šæ·»èŠ±çš„åŠŸèƒ½                                                  â”ƒ
â”ƒ     â€¢ å¯åœ¨åç»­ç‰ˆæœ¬å®ç°                                                â”ƒ
â”ƒ     â€¢ v2.0+ç‰ˆæœ¬è€ƒè™‘                                                   â”ƒ
â”ƒ                                                                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## 2. M1 - å‘Šè­¦æ¥å…¥æ¨¡å—

### 2.1 M1.1 å¤šåè®®æ¥å…¥ (P0)

**åŠŸèƒ½æè¿°**: æ”¯æŒå¤šç§æ ‡å‡†åè®®æ¥å…¥å‘Šè­¦æ•°æ®

**è¯¦ç»†éœ€æ±‚**:

| åè®® | ä¼˜å…ˆçº§ | æè¿° | å®ç°è¦ç‚¹ |
|------|--------|------|----------|
| REST API | P0 | JSONæ ¼å¼å‘Šè­¦æäº¤ | FastAPIå®ç°ï¼Œæ”¯æŒæ‰¹é‡ |
| Syslog | P1 | RFC5424/RFC5425æ ‡å‡† | syslog-ngè½¬å‘ |
| CEF | P1 | Common Event Format | ArcSightå…¼å®¹ |
| LEAF | P2 | Log Event Archive Format | å¯é€‰åè®® |
| MQTT | P2 | IoTè®¾å¤‡å‘Šè­¦ | EMQX Broker |
| WebSocket | P2 | å®æ—¶å‘Šè­¦æµ | åŒå‘é€šä¿¡ |

**APIç«¯ç‚¹**:
```
POST /api/v1/alerts              # å•ä¸ªå‘Šè­¦
POST /api/v1/alerts/batch        # æ‰¹é‡å‘Šè­¦
GET  /api/v1/alerts/health       # å¥åº·æ£€æŸ¥
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ æ¥æ”¶å»¶è¿Ÿ < 100ms (P50)
- âœ“ æ”¯æŒå¹¶å‘100è¯·æ±‚/ç§’
- âœ“ è¯·æ±‚éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ“ APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

---

### 2.2 M1.2 å‘Šè­¦æ ¼å¼æ ‡å‡†åŒ– (P0)

**åŠŸèƒ½æè¿°**: å°†ä¸åŒè®¾å¤‡æ ¼å¼çš„å‘Šè­¦æ˜ å°„åˆ°ç»Ÿä¸€Schema

**è¯¦ç»†éœ€æ±‚**:

```
æ ‡å‡†å‘Šè­¦Schema (åŸºäºOCSF):
{
  "alert_id": "string",           // å”¯ä¸€æ ‡è¯†
  "timestamp": "ISO8601",         // å‘Šè­¦æ—¶é—´(UTC)
  "event_type": "string",         // äº‹ä»¶ç±»å‹
  "severity": "critical|high|medium|low|info",
  "source": {
    "ip": "string",
    "port": int,
    "geo_location": {
      "country": "string",
      "city": "string",
      "coordinates": [lat, lon]
    }
  },
  "target": {
    "ip": "string",
    "port": int,
    "asset": {
      "id": "string",
      "type": "string",
      "name": "string"
    }
  },
  "description": "string",
  "iocs": [                       // æå–çš„IOCs
    {
      "type": "ip|domain|hash|url|email",
      "value": "string"
    }
  ],
  "raw_data": {}                  // åŸå§‹æ•°æ®
}
```

**è®¾å¤‡ç±»å‹æ˜ å°„**:
- é˜²ç«å¢™ (Palo Alto, Fortinet, Checkpoint)
- IDS/IPS (Snort, Suricata)
- EDR (CrowdStrike, SentinelOne)
- WAF (ModSecurity, AWS WAF)
- SIEM (Splunk, QRadar, ELK)

**éªŒæ”¶æ ‡å‡†**:
- âœ“ æ”¯æŒ10+ç§å¸¸è§å®‰å…¨è®¾å¤‡
- âœ“ IOCè‡ªåŠ¨æå–å‡†ç¡®ç‡ > 90%
- âœ“ æ—¶åŒºè‡ªåŠ¨è½¬æ¢ä¸ºUTC
- âœ“ å­—æ®µæ˜ å°„å¯é…ç½®

---

### 2.3 M1.3 å‘Šè­¦èšåˆ (P1)

**åŠŸèƒ½æè¿°**: å¯¹ç›¸ä¼¼å‘Šè­¦è¿›è¡Œæ—¶é—´çª—å£èšåˆ

**èšåˆç­–ç•¥**:

| ç­–ç•¥ | æè¿° | æ—¶é—´çª—å£ |
|------|------|----------|
| æ—¶é—´èšåˆ | ç›¸åŒç±»å‹+ç›¸åŒæºIP | 1/5/15åˆ†é’Ÿ |
| ç‰¹å¾èšåˆ | ç›¸åŒå…³é”®ç‰¹å¾ç»„åˆ | å¯é…ç½® |
| æ‰¹é‡èšåˆ | æ‰¹é‡æ”»å‡»æ¨¡å¼ | åŠ¨æ€ |
| æŠ‘åˆ¶èšåˆ | é‡å¤å‘Šè­¦æŠ‘åˆ¶ | å¯é…ç½® |

**èšåˆè¾“å‡º**:
```json
{
  "aggregation_id": "string",
  "alert_count": 10,
  "time_window": "5m",
  "first_seen": "timestamp",
  "last_seen": "timestamp",
  "alerts": ["alert_id1", "alert_id2", ...],
  "aggregation_key": "type+source_ip",
  "summary": {
    "source_ips": ["ip1", "ip2"],
    "target_ips": ["ip1"],
    "attack_pattern": "brute_force"
  }
}
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ èšåˆå»¶è¿Ÿ < 1s
- âœ“ èšåˆå‡†ç¡®ç‡ > 95%
- âœ“ æ”¯æŒè‡ªå®šä¹‰èšåˆè§„åˆ™

---

## 3. M2 - å¨èƒæƒ…æŠ¥æ¨¡å—

### 3.1 M2.1 å¤šæºæƒ…æŠ¥èšåˆ (P0)

**åŠŸèƒ½æè¿°**: é›†æˆå¤šä¸ªå¨èƒæƒ…æŠ¥æºï¼ŒèšåˆIOCä¿¡æ¯

**æ”¯æŒçš„æƒ…æŠ¥æº**:

| æƒ…æŠ¥æº | ç±»å‹ | è¦†ç›–èŒƒå›´ | ä¼˜å…ˆçº§ |
|--------|------|----------|--------|
| VirusTotal | æ–‡ä»¶/URL/IP | å…¨çƒ | P0 |
| AlienVault OTX | å¨èƒæŒ‡æ ‡ | å…¨çƒ | P0 |
| Abuse.ch | æ¶æ„åŸŸå/IP | å…¨çƒ | P1 |
| CIRCL | è¢«åŠ¨DNS | æ¬§æ´² | P2 |
| å¾®æ­¥åœ¨çº¿ | å¨èƒæƒ…æŠ¥ | ä¸­å›½ | P1 |
| 360å¨èƒæƒ…æŠ¥ | å¨èƒæƒ…æŠ¥ | ä¸­å›½ | P1 |
| å†…éƒ¨æƒ…æŠ¥åº“ | è‡ªå®šä¹‰IOCs | å†…éƒ¨ | P0 |

**APIé›†æˆç¤ºä¾‹**:
```python
# VirusTotal API
GET https://www.virusscan.com/vtapi/v2/file/report
Parameters: apikey, resource

# AlienVault OTX
GET https://otx.alienvault.com/api/v1/indicators/IPv4/{ip}/general

# Abuse.ch
GET https://feodotracker.abuse.ch/browse/host/{ip}/
```

**èšåˆç»“æœæ ¼å¼**:
```json
{
  "ioc": "45.33.32.156",
  "ioc_type": "ip",
  "sources": [
    {
      "name": "VirusTotal",
      "detection_rate": 45,
      "last_seen": "2025-01-04",
      "classification": "malicious"
    },
    {
      "name": "OTX",
      "pulse_count": 12,
      "reputation": "malicious"
    }
  ],
  "aggregate_score": 8.5,
  "threat_level": "critical",
  "confidence": 0.92,
  "tags": ["botnet", "c2"],
  "first_seen": "2024-12-01",
  "last_seen": "2025-01-04"
}
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ æ”¯æŒ5+ä¸ªæƒ…æŠ¥æº
- âœ“ æŸ¥è¯¢å“åº”æ—¶é—´ < 2s (å•ä¸ªIOC)
- âœ“ æƒ…æŠ¥æºå¤±è´¥ä¸å½±å“æ•´ä½“

---

### 3.2 M2.2 æƒ…æŠ¥ç¼“å­˜ç­–ç•¥ (P0)

**åŠŸèƒ½æè¿°**: å¤šçº§ç¼“å­˜å‡å°‘APIè°ƒç”¨ï¼Œæå‡æ€§èƒ½

**ç¼“å­˜æ¶æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1: å†…å­˜ç¼“å­˜ (è¿›ç¨‹å†…)                       â”‚
â”‚  â€¢ å®¹é‡: 10K IOCs                           â”‚
â”‚  â€¢ TTL: 5åˆ†é’Ÿ                               â”‚
â”‚  â€¢ å‘½ä¸­ç‡ç›®æ ‡: 60%                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L2: Redisç¼“å­˜                              â”‚
â”‚  â€¢ å®¹é‡: 1M IOCs                            â”‚
â”‚  â€¢ TTL: 1h/24h/7d (åˆ†çº§)                   â”‚
â”‚  â€¢ å‘½ä¸­ç‡ç›®æ ‡: 30%                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L3: APIè°ƒç”¨                                 â”‚
â”‚  â€¢ å‰©ä½™10%è¯·æ±‚                              â”‚
â”‚  â€¢ ç¼“å­˜å›å¡«                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¼“å­˜ç­–ç•¥**:
- **çƒ­æ•°æ®**: æœ€è¿‘1å¤©æŸ¥è¯¢çš„IOCsï¼ŒTTL=1h
- **æ¸©æ•°æ®**: æœ€è¿‘7å¤©æŸ¥è¯¢çš„IOCsï¼ŒTTL=24h
- **å†·æ•°æ®**: å†å²IOCsï¼ŒTTL=7d
- **é¢„åŠ è½½**: é«˜é¢‘IOCsé¢„åŠ è½½åˆ°å†…å­˜

**ç¼“å­˜æ›´æ–°**:
```python
# Cache-Aside Pattern
async def get_threat_intel(ioc: str):
    # L1: Memory Cache
    if intel := memory_cache.get(ioc):
        return intel

    # L2: Redis
    if intel := await redis_cache.get(ioc):
        memory_cache.set(ioc, intel, ttl=300)
        return intel

    # L3: API
    intel = await query_threat_intel_apis(ioc)

    # å›å¡«ç¼“å­˜
    await redis_cache.set(ioc, intel, ttl=3600)
    memory_cache.set(ioc, intel, ttl=300)

    return intel
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ ç¼“å­˜å‘½ä¸­ç‡ > 85%
- âœ“ ç¼“å­˜æ›´æ–°å»¶è¿Ÿ < 100ms
- âœ“ æ”¯æŒç¼“å­˜é¢„çƒ­

---

### 3.3 M2.3 æƒ…æŠ¥è¯„åˆ† (P1)

**åŠŸèƒ½æè¿°**: å¤šæºæƒ…æŠ¥ç»¼åˆè¯„åˆ†ç®—æ³•

**è¯„åˆ†æ¨¡å‹**:
```python
def calculate_threat_score(sources: List[Source]) -> float:
    """
    å¨èƒè¯„åˆ† = Î£(æºæƒé‡ Ã— æºåˆ†æ•° Ã— æ–°é²œåº¦å› å­)
    """
    score = 0.0
    for source in sources:
        # æºæƒé‡
        weight = SOURCE_WEIGHTS[source.name]

        # æºåˆ†æ•° (0-10)
        source_score = source.malicious_score

        # æ–°é²œåº¦å› å­
        days_since_last_seen = (now - source.last_seen).days
        freshness = max(0.3, 1.0 - (days_since_last_seen / 30))

        score += weight * source_score * freshness

    # å½’ä¸€åŒ–åˆ°0-10
    return min(10.0, score / len(sources))
```

**æºæƒé‡é…ç½®**:
```yaml
threat_intel:
  source_weights:
    virustotal: 0.3
    otx: 0.25
    abuse_ch: 0.2
    internal: 0.15
    other: 0.1
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ è¯„åˆ†ç®—æ³•å¯é…ç½®
- âœ“ æ”¯æŒè¯¯æŠ¥ç‡è°ƒæ•´
- âœ“ è¯„åˆ†ç»“æœå¯è§£é‡Š

---

## 4. M3 - ä¸Šä¸‹æ–‡å¢å¼ºæ¨¡å—

### 4.1 M3.1 ç½‘ç»œä¸Šä¸‹æ–‡ (P0)

**åŠŸèƒ½æè¿°**: æ”¶é›†IPç›¸å…³çš„ç½‘ç»œä¸Šä¸‹æ–‡ä¿¡æ¯

**ä¸Šä¸‹æ–‡è¦ç´ **:
```json
{
  "network_context": {
    "source_ip": "45.33.32.156",
    "is_internal": false,
    "is_proxy": false,
    "is_vpn": false,
    "geo_location": {
      "country": "US",
      "country_code": "US",
      "region": "California",
      "city": "San Francisco",
      "coordinates": [37.7749, -122.4194],
      "asn": 15169,
      "isp": "Google LLC"
    },
    "reputation": {
      "score": 2.3,
      "is_known_malicious": false,
      "is_tor_exit_node": false,
      "abuse_confidence": 15
    },
    "port_scan": {
      "common_ports": [22, 80, 443],
      "service_detection": ["ssh", "http", "https"]
    }
  }
}
```

**æ•°æ®æº**:
- MaxMind GeoIP2 (åœ°ç†ä½ç½®)
- AbuseIPDB (ä¿¡èª‰è¯„åˆ†)
- Shodan (ç«¯å£æ‰«æ)

**éªŒæ”¶æ ‡å‡†**:
- âœ“ ç½‘ç»œä¸Šä¸‹æ–‡æŸ¥è¯¢ < 500ms
- âœ“ æ”¯æŒ100K+ IPæŸ¥è¯¢/å¤©

---

### 4.2 M3.2 èµ„äº§ä¸Šä¸‹æ–‡ (P0)

**åŠŸèƒ½æè¿°**: ä»CMDBæŸ¥è¯¢èµ„äº§ä¿¡æ¯

**ä¸Šä¸‹æ–‡è¦ç´ **:
```json
{
  "asset_context": {
    "asset_id": "ASSET-001",
    "asset_name": "prod-web-01",
    "asset_type": "server",
    "criticality": "high",
    "owner": "team-platform",
    "business_unit": "engineering",
    "environment": "production",
    "os": {
      "name": "Ubuntu",
      "version": "22.04 LTS"
    },
    "vulnerabilities": {
      "critical": 2,
      "high": 5,
      "medium": 12,
      "low": 8,
      "patch_status": "partial"
    },
    "recent_incidents": 3,
    "last_scan": "2025-01-03"
  }
}
```

**CMDBé›†æˆ**:
- REST APIæŸ¥è¯¢
- èµ„äº§è‡ªåŠ¨å‘ç°
- å˜æ›´é€šçŸ¥

**éªŒæ”¶æ ‡å‡†**:
- âœ“ CMDBæŸ¥è¯¢ < 200ms
- âœ“ èµ„äº§ä¿¡æ¯å®æ—¶åŒæ­¥

---

### 4.3 M3.3 ç”¨æˆ·ä¸Šä¸‹æ–‡ (P1)

**åŠŸèƒ½æè¿°**: ä»IAMç³»ç»ŸæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯

**ä¸Šä¸‹æ–‡è¦ç´ **:
```json
{
  "user_context": {
    "user_id": "user@example.com",
    "username": "john.doe",
    "department": "engineering",
    "role": "developer",
    "access_level": "standard",
    "manager": "manager@example.com",
    "location": "Beijing",
    "login_history": {
      "last_login": "2025-01-05T09:30:00Z",
      "last_location": "Beijing",
      "last_ip": "192.168.1.100",
      "unusual_login": false
    },
    "behavior_profile": {
      "typical_hours": ["09:00-18:00"],
      "typical_locations": ["Beijing", "Shanghai"],
      "anomaly_score": 0.15
    }
  }
}
```

**IAMé›†æˆ**:
- LDAP/ADæŸ¥è¯¢
- SSOé›†æˆ
- è¡Œä¸ºåŸºçº¿åˆ†æ

**éªŒæ”¶æ ‡å‡†**:
- âœ“ ç”¨æˆ·æŸ¥è¯¢ < 300ms
- âœ“ å¼‚å¸¸æ£€æµ‹å‡†ç¡®ç‡ > 85%

---

## 5. M4 - AIç ”åˆ¤æ¨¡å—

### 5.1 M4.1 é£é™©è¯„ä¼° (P0)

**åŠŸèƒ½æè¿°**: å¤šç»´åº¦é£é™©è¯„åˆ†

**è¯„åˆ†ç»´åº¦**:
```python
def calculate_risk_score(alert: Alert, context: Context, intel: List) -> RiskAssessment:
    """
    é£é™©è¯„åˆ† = Î£(ç»´åº¦æƒé‡ Ã— ç»´åº¦åˆ†æ•°)

    ç»´åº¦:
    1. å‘Šè­¦ä¸¥é‡åº¦ (30%)
    2. å¨èƒæƒ…æŠ¥è¯„åˆ† (30%)
    3. èµ„äº§é‡è¦æ€§ (20%)
    4. å¯åˆ©ç”¨æ€§ (20%)
    """

    # 1. å‘Šè­¦ä¸¥é‡åº¦ (0-10)
    severity_score = SEVERITY_MAP[alert.severity]  # critical=10, high=7, ...

    # 2. å¨èƒæƒ…æŠ¥è¯„åˆ† (0-10)
    threat_score = aggregate_threat_intel_score(intel)

    # 3. èµ„äº§é‡è¦æ€§ (0-10)
    asset_multiplier = ASSET_CRITICALITY_MAP[context.asset.criticality]

    # 4. å¯åˆ©ç”¨æ€§ (0-10)
    exploit_multiplier = EXPLOITABILITY_MAP[context.vulnerabilities]

    # åŠ æƒè®¡ç®—
    risk_score = (
        severity_score * 0.3 +
        threat_score * 10 * 0.3 +
        asset_multiplier * 20 * 0.2 +
        exploit_multiplier * 20 * 0.2
    )

    # é£é™©çº§åˆ«
    risk_level = score_to_level(risk_score)  # >90=critical, >70=high, ...

    return RiskAssessment(
        risk_score=round(risk_score, 2),
        risk_level=risk_level,
        confidence=calculate_confidence(context, intel),
        key_factors=extract_key_factors(alert, context, intel)
    )
```

**é£é™©çº§åˆ«æ˜ å°„**:
```
Critical: 90-100 (ç«‹å³å¤„ç†)
High:     70-89  (1å°æ—¶å†…)
Medium:   40-69  (24å°æ—¶å†…)
Low:      20-39  (è§‚å¯Ÿ)
Info:     0-19   (è®°å½•)
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ é£é™©è¯„åˆ†å‡†ç¡®ç‡ > 85% (äººå·¥éªŒè¯)
- âœ“ è¯„åˆ†å»¶è¿Ÿ < 500ms
- âœ“ æ”¯æŒè¯„åˆ†ç®—æ³•è°ƒä¼˜

---

### 5.2 M4.2 ç›¸ä¼¼å‘Šè­¦æ£€ç´¢ (P1)

**åŠŸèƒ½æè¿°**: åŸºäºå‘é‡æ£€ç´¢ç›¸ä¼¼å†å²å‘Šè­¦

**æŠ€æœ¯å®ç°**:
```python
async def find_similar_alerts(alert: Alert, top_k: int = 5) -> List[SimilarAlert]:
    """
    1. ç”Ÿæˆå‘Šè­¦åµŒå…¥å‘é‡
    2. ChromaDBå‘é‡æ£€ç´¢
    3. è¿”å›æœ€ç›¸ä¼¼çš„kä¸ªå‘Šè­¦
    """

    # æ„å»ºæŸ¥è¯¢æ–‡æœ¬
    query_text = f"""
    Alert Type: {alert.alert_type}
    Description: {alert.description}
    Source IP: {alert.source_ip}
    Target IP: {alert.target_ip}
    Severity: {alert.severity}
    IOCs: {alert.iocs}
    """

    # å‘é‡åµŒå…¥
    embedding = await embedding_fn.embed(query_text)

    # ChromaDBæ£€ç´¢
    results = chroma_collection.query(
        query_embeddings=[embedding],
        n_results=top_k,
        where={
            "resolved": True,
            "false_positive": False
        }
    )

    # è¿”å›ç›¸ä¼¼å‘Šè­¦
    similar_alerts = []
    for i, (doc, metadata, distance) in enumerate(zip(
        results["documents"][0],
        results["metadatas"][0],
        results["distances"][0]
    )):
        similar_alerts.append(SimilarAlert(
            alert_id=metadata["alert_id"],
            similarity=1 - distance,  # ä½™å¼¦ç›¸ä¼¼åº¦
            description=doc,
            resolution=metadata["resolution"],
            risk_score=metadata["risk_score"]
        ))

    return similar_alerts
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ æ£€ç´¢å»¶è¿Ÿ < 1s
- âœ“ ç›¸ä¼¼åº¦å‡†ç¡®ç‡ > 80% (äººå·¥è¯„ä¼°)
- âœ“ æ”¯æŒç™¾ä¸‡çº§å‘é‡åº“

---

### 5.3 M4.3 æ”»å‡»é“¾åˆ†æ (P2)

**åŠŸèƒ½æè¿°**: è¯†åˆ«æ”»å‡»é“¾å’ŒMITRE ATT&CKæŠ€æœ¯

**æ”»å‡»é“¾æ˜ å°„**:
```json
{
  "attack_chain_analysis": {
    "kill_chain_stage": "exploitation",
    "mitre_techniques": [
      {
        "technique_id": "T1190",
        "technique_name": "Exploit Public-Facing Application",
        "tactics": ["initial_access"],
        "confidence": 0.85
      },
      {
        "technique_id": "T1078",
        "technique_name": "Valid Accounts",
        "tactics": ["defense_evasion", "persistence"],
        "confidence": 0.72
      }
    ],
    "attack_pattern": "credential_stuffing",
    "next Likely_steps": [
      "lateral_movement",
      "data_exfiltration"
    ]
  }
}
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ MITREæ˜ å°„è¦†ç›–ç‡ > 70%
- âœ“ æ”»å‡»é˜¶æ®µè¯†åˆ«å‡†ç¡®ç‡ > 75%

---

### 5.4 M4.4 LLMæ™ºèƒ½åˆ†æ (P0)

**åŠŸèƒ½æè¿°**: ä½¿ç”¨DeepSeek/Qwen3è¿›è¡Œæ·±åº¦åˆ†æ

**åˆ†æç±»å‹**:

1. **å‘Šè­¦æè¿°ç”Ÿæˆ** (P0)
2. **å¤„ç½®å»ºè®®ç”Ÿæˆ** (P0)
3. **è‡ªç„¶è¯­è¨€æŸ¥è¯¢** (P1)
4. **æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆ** (P1)

**LLMè·¯ç”±ç­–ç•¥**:
```python
def route_llm_task(task_type: str, complexity: str) -> str:
    """
    æ™ºèƒ½è·¯ç”±åˆ°åˆé€‚çš„æ¨¡å‹
    """

    # ç®€å•ä»»åŠ¡ â†’ Qwen3 (å¿«é€Ÿã€ä½æˆæœ¬)
    if task_type in ["description_generation", "simple_query"]:
        if complexity == "low":
            return "qwen3"

    # å¤æ‚ä»»åŠ¡ â†’ DeepSeek-V3 (æ·±åº¦æ¨ç†)
    if task_type in ["deep_analysis", "attack_chain"]:
        return "deepseek"

    # é»˜è®¤
    return "qwen3"
```

**Promptè®¾è®¡ç¤ºä¾‹**:
```python
TRIAGE_ANALYSIS_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªç½‘ç»œå®‰å…¨ä¸“å®¶ï¼Œæ­£åœ¨åˆ†æä¸€ä¸ªå®‰å…¨å‘Šè­¦ã€‚

## å‘Šè­¦ä¿¡æ¯
- ç±»å‹: {alert_type}
- æè¿°: {description}
- ä¸¥é‡åº¦: {severity}
- æºIP: {source_ip}
- ç›®æ ‡IP: {target_ip}

## ä¸Šä¸‹æ–‡ä¿¡æ¯
- ç½‘ç»œ: {network_context}
- èµ„äº§: {asset_context}
- ç”¨æˆ·: {user_context}

## å¨èƒæƒ…æŠ¥
{threat_intel_summary}

## ç›¸ä¼¼å†å²å‘Šè­¦
{similar_alerts_summary}

è¯·æä¾›:
1. å‘Šè­¦ä¸¥é‡æ€§è¯„ä¼° (0-10åˆ†)
2. æ”»å‡»æ„å›¾åˆ†æ
3. å»ºè®®çš„ç«‹å³è¡ŒåŠ¨
4. å…³é”®é£é™©å› ç´ 

è¯·ä»¥JSONæ ¼å¼å›ç­”ã€‚
"""
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ LLMåˆ†æå»¶è¿Ÿ < 5s (P95)
- âœ“ åˆ†æè´¨é‡è¯„åˆ† > 4.0/5.0 (äººå·¥è¯„ä¼°)
- âœ“ æ¨¡å‹åˆ‡æ¢é€æ˜

---

## 6. M5 - å·¥ä½œæµç®¡ç†æ¨¡å—

### 6.1 M5.1 çŠ¶æ€ç®¡ç† (P0)

**åŠŸèƒ½æè¿°**: å‘Šè­¦ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº

**çŠ¶æ€å®šä¹‰**:
```
new â†’ assigned â†’ in_progress â†’ resolved â†’ closed
  â†“                                              â†‘
rejected â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€è½¬æ¢è§„åˆ™**:
```yaml
state_transitions:
  new:
    - to: assigned
      condition: has_assignee
    - to: rejected
      condition: is_false_positive
      permission: analyst

  assigned:
    - to: in_progress
      condition: acknowledged
    - to: new
      condition: unassigned

  in_progress:
    - to: resolved
      condition: remediation_completed
      permission: analyst
    - to: new
      condition: reassigned

  resolved:
    - to: closed
      condition: confirmed
      timeout: 24h
      auto_close: true
    - to: in_progress
      condition: reopened

  closed:
    - to: in_progress
      condition: new_evidence
      permission: supervisor
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ çŠ¶æ€è½¬æ¢100%å¯è¿½æº¯
- âœ“ æ”¯æŒçŠ¶æ€æ¢å¤

---

### 6.2 M5.2 ä»»åŠ¡åˆ†é… (P0)

**åŠŸèƒ½æè¿°**: è‡ªåŠ¨æˆ–æ‰‹åŠ¨åˆ†é…å‘Šè­¦

**åˆ†é…ç­–ç•¥**:

| ç­–ç•¥ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| åŸºäºæŠ€èƒ½ | æ ¹æ®å‘Šè­¦ç±»å‹å’Œåˆ†æå¸ˆä¸“é•¿ | P0 |
| åŸºäºè´Ÿè½½ | å‡è¡¡åˆ†é…å·¥ä½œè´Ÿè½½ | P0 |
| åŸºäºå€¼ç­ | æŒ‰å€¼ç­è¡¨è‡ªåŠ¨åˆ†é… | P1 |
| æ‰‹åŠ¨æŒ‡å®š | åˆ†æå¸ˆä¸»åŠ¨è®¤é¢† | P0 |
| å‡çº§åˆ†é… | SLAè¶…æ—¶è‡ªåŠ¨å‡çº§ | P1 |

**è´Ÿè½½å‡è¡¡ç®—æ³•**:
```python
def assign_alert(alert: Alert) -> User:
    """
    åŸºäºå¤šå› ç´ åˆ†é…
    """

    # 1. ç­›é€‰å…·å¤‡æŠ€èƒ½çš„åˆ†æå¸ˆ
    qualified_analysts = get_users_with_skill(alert.alert_type)

    # 2. è®¡ç®—å½“å‰è´Ÿè½½
    for analyst in qualified_analysts:
        analyst.load = count_active_alerts(analyst)

    # 3. é€‰æ‹©è´Ÿè½½æœ€ä½çš„
    assigned_analyst = min(qualified_analysts, key=lambda a: a.load)

    return assigned_analyst
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ è‡ªåŠ¨åˆ†é…å‡†ç¡®ç‡ > 80%
- âœ“ åˆ†é…å»¶è¿Ÿ < 1s

---

### 6.3 M5.3 SLAç®¡ç† (P1)

**åŠŸèƒ½æè¿°**: æœåŠ¡çº§åˆ«åè®®ç®¡ç†

**SLAå®šä¹‰**:
```yaml
slas:
  critical:
    response_time: 5m     # 5åˆ†é’Ÿå†…å“åº”
    resolve_time: 30m     # 30åˆ†é’Ÿå†…è§£å†³
  high:
    response_time: 15m
    resolve_time: 2h
  medium:
    response_time: 1h
    resolve_time: 24h
  low:
    response_time: 4h
    resolve_time: 7d
```

**SLAç›‘æ§**:
```python
def check_sla_compliance(alert: Alert):
    """
    æ£€æŸ¥SLAåˆè§„æ€§
    """

    sla = get_sla(alert.severity)

    # å“åº”æ—¶é—´
    if alert.status == "new":
        time_since_creation = now() - alert.created_at
        if time_since_creation > sla.response_time:
            trigger_sla_breach_alert(alert, "response")

    # è§£å†³æ—¶é—´
    if alert.status in ["new", "assigned", "in_progress"]:
        time_since_creation = now() - alert.created_at
        if time_since_creation > sla.resolve_time:
            trigger_sla_breach_alert(alert, "resolution")
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ SLAè¿è§„è‡ªåŠ¨å‘Šè­¦
- âœ“ SLAåˆè§„ç‡ > 95%

---

### 6.4 M5.4 åä½œåŠŸèƒ½ (P1)

**åŠŸèƒ½æè¿°**: å›¢é˜Ÿåä½œå’ŒçŸ¥è¯†å…±äº«

**åŠŸèƒ½åˆ—è¡¨**:
- è¯„è®º/å¤‡æ³¨
- @æåŠé€šçŸ¥
- æ–‡ä»¶é™„ä»¶
- æ ‡ç­¾ç®¡ç†
- ç›¸å…³å‘Šè­¦å…³è”
- çŸ¥è¯†åº“é“¾æ¥

**éªŒæ”¶æ ‡å‡†**:
- âœ“ åä½œæ“ä½œå»¶è¿Ÿ < 200ms
- âœ“ æ”¯æŒå®æ—¶é€šçŸ¥

---

## 7. M6 - è‡ªåŠ¨å“åº”æ¨¡å—

### 7.1 M6.1 SOARé›†æˆ (P1)

**åŠŸèƒ½æè¿°**: è‡ªåŠ¨åŒ–å“åº”ç¼–æ’

**Playbookç±»å‹**:
```yaml
playbooks:
  block_ip:
    description: "é˜»æ–­æ¶æ„IP"
    actions:
      - firewall_block
      - siem_add_to_blacklist
    approval: required

  isolate_host:
    description: "éš”ç¦»å—æ„ŸæŸ“ä¸»æœº"
    actions:
      - edr_isolate
      - network_quarantine
    approval: required

  disable_account:
    description: "ç¦ç”¨å—æŸè´¦æˆ·"
    actions:
      - iam_disable_user
      - revoke_sessions
    approval: required

  collect_evidence:
    description: "æ”¶é›†å–è¯ä¿¡æ¯"
    actions:
      - capture_memory_dump
      - collect_disk_image
      - preserve_logs
    approval: not_required
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ Playbookæ‰§è¡ŒæˆåŠŸç‡ > 95%
- âœ“ æ‰§è¡Œå»¶è¿Ÿ < 10s

---

### 7.2 M6.2 å®¡æ‰¹æµç¨‹ (P0)

**åŠŸèƒ½æè¿°**: é«˜å±åŠ¨ä½œå®¡æ‰¹

**å®¡æ‰¹çº§åˆ«**:
```yaml
approval_levels:
  low_risk:
    - auto_response
    - notification
    requires_approval: false

  medium_risk:
    - block_ip
    - enhanced_monitoring
    requires_approval: team_lead

  high_risk:
    - isolate_host
    - disable_account
    - shutdown_service
    requires_approval: manager

  critical_risk:
    - shutdown_datacenter
    - block_subnet
    requires_approval: director
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ å®¡æ‰¹æµç¨‹å¯è¿½æº¯
- âœ“ æ”¯æŒç§»åŠ¨ç«¯å®¡æ‰¹

---

## 8. M7 - é€šçŸ¥å‘Šè­¦æ¨¡å—

### 8.1 M7.1 å¤šæ¸ é“é€šçŸ¥ (P0)

**é€šçŸ¥æ¸ é“**:

| æ¸ é“ | ç±»å‹ | ä¼˜å…ˆçº§ | ç”¨é€” |
|------|------|--------|------|
| Email | å¼‚æ­¥ | P0 | æ­£å¼é€šçŸ¥ã€æŠ¥å‘Š |
| SMS | å®æ—¶ | P1 | ç´§æ€¥å‘Šè­¦ |
| å³æ—¶é€šè®¯ | å®æ—¶ | P0 | å›¢é˜Ÿåä½œ |
| Webhook | å¼‚æ­¥ | P1 | é›†æˆç¬¬ä¸‰æ–¹ |
| PagerDuty | å®æ—¶ | P2 | å€¼ç­ç®¡ç† |

**é€šçŸ¥æ¨¡æ¿**:
```python
CRITICAL_ALERT_TEMPLATE = """
ğŸš¨ CRITICAL SECURITY ALERT

Alert ID: {alert_id}
Severity: CRITICAL
Risk Score: {risk_score}/100

Description:
{description}

Immediate Actions Required:
{actions}

Assignee: {assignee}
View Details: {link}
"""
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ é€šçŸ¥å‘é€å»¶è¿Ÿ < 5s
- âœ“ é€šçŸ¥åˆ°è¾¾ç‡ > 99%

---

### 8.2 M7.2 æ™ºèƒ½è·¯ç”± (P1)

**åŠŸèƒ½æè¿°**: åŸºäºè§„åˆ™çš„é€šçŸ¥è·¯ç”±

**è·¯ç”±è§„åˆ™**:
```yaml
notification_routes:
  - name: "Critical to On-call"
    condition:
      severity: critical
    channels:
      - sms
      - pagerduty
    escalation:
      after: 5m
      to: manager

  - name: "High to Team"
    condition:
      severity: high
      team: platform
    channels:
      - slack
      - email
    routing:
      by: skill
      fallback: on_call

  - name: "Batch Notification"
    condition:
      aggregation: true
      count: >10
    channels:
      - email
      - slack
    throttle: 15m
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ è·¯ç”±å‡†ç¡®ç‡ > 98%
- âœ“ æ”¯æŒè·¯ç”±è§„åˆ™çƒ­æ›´æ–°

---

## 9. M8 - å¯è§†åŒ–ä¸æŠ¥è¡¨

### 9.1 M8.1 å®æ—¶ä»ªè¡¨æ¿ (P0)

**ä»ªè¡¨æ¿ç»„ä»¶**:
- å‘Šè­¦è¶‹åŠ¿å›¾ (æ—¶é—´åºåˆ—)
- é«˜å±å‘Šè­¦Top10
- å¤„ç†æ•ˆç‡ç»Ÿè®¡
- èµ„äº§é£é™©çƒ­åŠ›å›¾
- å¨èƒæƒ…æŠ¥å‘½ä¸­ç‡
- SLAåˆè§„ç‡

**éªŒæ”¶æ ‡å‡†**:
- âœ“ ä»ªè¡¨æ¿åˆ·æ–° < 3s
- âœ“ æ”¯æŒè‡ªå®šä¹‰å¸ƒå±€

---

### 9.2 M8.2 æŠ¥è¡¨ç”Ÿæˆ (P1)

**æŠ¥è¡¨ç±»å‹**:
- æ—¥æŠ¥/å‘¨æŠ¥/æœˆæŠ¥
- è‡ªå®šä¹‰æ—¶é—´èŒƒå›´
- æ‰§è¡Œæ‘˜è¦
- è¯¦ç»†åˆ†æ

**è¾“å‡ºæ ¼å¼**:
- PDF
- Excel
- CSV
- HTML

**éªŒæ”¶æ ‡å‡†**:
- âœ“ æŠ¥è¡¨ç”Ÿæˆ < 30s
- âœ“ æ”¯æŒå®šæ—¶ç”Ÿæˆ

---

## 10. M9 - ç³»ç»Ÿç®¡ç†æ¨¡å—

### 10.1 M9.1 ç”¨æˆ·æƒé™ (P0)

**RBACæ¨¡å‹**:
```yaml
roles:
  admin:
    permissions: ["*"]

  analyst:
    permissions:
      - alerts:read
      - alerts:update
      - alerts:assign
      - comments:create

  viewer:
    permissions:
      - alerts:read
      - reports:read

  auditor:
    permissions:
      - audit_logs:read
      - reports:read
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ æƒé™æ£€æŸ¥ < 10ms
- âœ“ æ”¯æŒæƒé™ç»§æ‰¿

---

### 10.2 M9.2 ç³»ç»Ÿé…ç½® (P0)

**é…ç½®é¡¹**:
- é£é™©è¯„åˆ†å‚æ•°
- å·¥ä½œæµè§„åˆ™
- é€šçŸ¥ç­–ç•¥
- å‘Šè­¦æºé…ç½®
- å¨èƒæƒ…æŠ¥æºé…ç½®

**éªŒæ”¶æ ‡å‡†**:
- âœ“ é…ç½®å®æ—¶ç”Ÿæ•ˆ
- âœ“ æ”¯æŒé…ç½®ç‰ˆæœ¬ç®¡ç†

---

## 11. M10 - ç›‘æ§è¿ç»´æ¨¡å—

### 11.1 M10.1 ç³»ç»Ÿç›‘æ§ (P0)

**ç›‘æ§æŒ‡æ ‡**:
```yaml
metrics:
  service_health:
    - uptime
    - error_rate
    - request_rate

  performance:
    - p50_latency
    - p95_latency
    - p99_latency

  resources:
    - cpu_usage
    - memory_usage
    - disk_usage
    - network_io

  business:
    - alerts_per_minute
    - triage_rate
    - sla_compliance
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ ç›‘æ§æ•°æ®å»¶è¿Ÿ < 1s
- âœ“ æ”¯æŒ1000+æŒ‡æ ‡

---

### 11.2 M10.2 å‘Šè­¦ç›‘æ§ (P0)

**å‘Šè­¦è§„åˆ™**:
```yaml
alerts:
  - name: "Alert Backlog"
    condition: queue_depth > 1000
    severity: critical
    notification: pagerduty

  - name: "Processing Latency High"
    condition: p95_latency > 5s
    severity: warning
    notification: slack

  - name: "API Error Rate High"
    condition: error_rate > 1%
    severity: critical
    notification: slack + email
```

**éªŒæ”¶æ ‡å‡†**:
- âœ“ å‘Šè­¦è§¦å‘å‡†ç¡®ç‡ > 95%
- âœ“ å‘Šè­¦å‘é€å»¶è¿Ÿ < 10s

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-05
**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹[ç»„ä»¶æ¸…å•æ–‡æ¡£](./03_components_inventory.md)
