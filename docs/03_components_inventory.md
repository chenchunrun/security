# 组件清单

**版本**: v1.0  
**日期**: 2025-01-05  
**状态**: 详细设计阶段

---

## 1. 核心服务组件

### 1.1 服务清单

```
┌────────────────────────────────────────────────────────────────────────────┐
│                         微服务组件清单                                      │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 服务层组件                                                             │  │
│  ├─────────────────────────────────────────────────────────────────────┤  │
│  │                                                                      │  │
│  │ 1. API Gateway (Kong)                                                │  │
│  │    • 负载均衡                                                         │  │
│  │    • 认证鉴权 (JWT)                                                   │  │
│  │    • 限流熔断                                                         │  │
│  │    • TLS终止                                                          │  │
│  │    • API版本管理                                                      │  │
│  │                                                                      │  │
│  │ 2. Alert Ingestor Service                                            │  │
│  │    • 告警接收API                                                       │  │
│  │    • 协议解析 (REST/Syslog/CEF)                                       │  │
│  │    • 初步验证                                                         │  │
│  │    • 消息发布                                                         │  │
│  │                                                                      │  │
│  │ 3. Alert Normalizer Service                                          │  │
│  │    • 格式标准化                                                       │  │
│  │    • 字段映射                                                         │  │
│  │    • IOC提取                                                          │  │
│  │    • 告警聚合                                                         │  │
│  │                                                                      │  │
│  │ 4. Context Collector Service                                         │  │
│  │    • 网络上下文收集                                                    │  │
│  │    • 资产上下文查询                                                    │  │
│  │    • 用户上下文查询                                                    │  │
│  │    • GeoIP查询                                                        │  │
│  │                                                                      │  │
│  │ 5. Threat Intelligence Aggregator                                    │  │
│  │    • 多源情报查询                                                      │  │
│  │    • 情报聚合                                                         │  │
│  │    • 缓存管理                                                         │  │
│  │    • 评分计算                                                         │  │
│  │                                                                      │  │
│  │ 6. Asset Enricher Service                                            │  │
│  │    • CMDB查询                                                         │  │
│  │    • 漏洞扫描结果查询                                                  │  │
│  │    • 资产重要性评估                                                    │  │
│  │                                                                      │  │
│  │ 7. AI Triage Agent Service                                           │  │
│  │    • 风险评估 (DeepSeek/Qwen3)                                        │  │
│  │    • 相似告警检索                                                     │  │
│  │    • 处置建议生成                                                     │  │
│  │    • LLM智能分析                                                      │  │
│  │                                                                      │  │
│  │ 8. Similarity Search Service                                         │  │
│  │    • 向量嵌入生成                                                      │  │
│  │    • ChromaDB检索                                                     │  │
│  │    • 相似度计算                                                       │  │
│  │                                                                      │  │
│  │ 9. Attack Chain Analyzer Service                                     │  │
│  │    • MITRE ATT&CK映射                                                 │  │
│  │    • Kill Chain识别                                                  │  │
│  │    • TTPs提取                                                        │  │
│  │                                                                      │  │
│  │ 10. Decision Engine Service                                          │  │
│  │     • 人工审核判断                                                     │  │
│  │     • 升级决策                                                        │  │
│  │     • 路由规则执行                                                    │  │
│  │                                                                      │  │
│  │ 11. Workflow Engine Service (Temporal)                               │  │
│  │     • 工作流编排                                                      │  │
│  │     • 状态机管理                                                      │  │
│  │     • 任务分配                                                        │  │
│  │     • SLA监控                                                        │  │
│  │                                                                      │  │
│  │ 12. SOAR Automation Service                                          │  │
│  │     • Playbook执行                                                    │  │
│  │     • 自动响应动作                                                     │  │
│  │     • 审批流程                                                        │  │
│  │                                                                      │  │
│  │ 13. Notification Service                                             │  │
│  │     • 多渠道通知                                                       │  │
│  │     • 智能路由                                                        │  │
│  │     • 通知聚合                                                        │  │
│  │                                                                      │  │
│  │ 14. User Management Service                                          │  │
│  │     • 用户CRUD                                                       │  │
│  │     • RBAC权限                                                       │  │
│  │     • SSO集成                                                        │  │
│  │                                                                      │  │
│  │ 15. Reporting Service                                                │  │
│  │     • 报表生成                                                        │  │
│  │     • 数据导出                                                        │  │
│  │     • 定时任务                                                        │  │
│  │                                                                      │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 服务资源配置

```
┌────────────────────────────────────────────────────────────────────────────┐
│                         服务资源配置表                                      │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  服务名称              │ 副本数 │ CPU  │ 内存  │ 存储   │ 说明                │
│  ├──────────────────────────────────────────────────────────────────────────┤
│  api-gateway           │ 3      │ 1C   │ 2G    │ -      │ Kong               │
│  alert-ingestor        │ 3      │ 2C   │ 4G    │ -      │ 高并发入口          │
│  alert-normalizer      │ 3      │ 2C   │ 4G    │ -      │ CPU密集             │
│  context-collector     │ 3      │ 2C   │ 4G    │ -      │ 外部API调用         │
│  threat-intel-aggregator│ 3     │ 2C   │ 4G    │ -      │ 缓存密集           │
│  asset-enricher        │ 2      │ 1C   │ 2G    │ -      │ 低负载             │
│  triage-agent          │ 5      │ 4C   │ 8G    │ -      │ LLM调用，资源密集  │
│  similarity-search     │ 2      │ 4C   │ 16G   │ 100G  │ 向量计算，内存密集  │
│  attack-chain-analyzer │ 2      │ 2C   │ 4G    │ -      │ 分析服务           │
│  decision-engine       │ 2      │ 1C   │ 2G    │ -      │ 规则引擎           │
│  workflow-engine       │ 3      │ 2C   │ 4G    │ -      │ Temporal           │
│  soar-automation       │ 2      │ 2C   │ 4G    │ -      │ Ansible集成        │
│  notification-service  │ 2      │ 1C   │ 2G    │ -      │ 通知发送           │
│  user-management       │ 2      │ 1C   │ 2G    │ -      │ 用户管理           │
│  reporting-service     │ 2      │ 2C   │ 4G    │ -      │ 报表生成           │
│  web-ui                │ 3      │ 1C   │ 2G    │ -      │ React前端          │
│  └──────────────────────────────────────────────────────────────────────────┤
│  总计                  │ 44     │ 32C  │ 72G   │ 100G   │                    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 数据存储组件

### 2.1 存储组件清单

```
┌────────────────────────────────────────────────────────────────────────────┐
│                         数据存储组件                                        │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. PostgreSQL Cluster (Patroni + etcd)                                    │
│     • 主数据库                                                             │
│     • 告警数据、用户数据、配置数据、审计日志                                 │
│     • 3节点高可用                                                          │
│     • 自动故障转移                                                         │
│                                                                              │
│  2. Redis Cluster                                                          │
│     • 缓存层                                                               │
│     • 会话存储、热数据缓存、速率限制                                         │
│     • 6节点(3主3从)                                                        │
│     • 自动分片                                                             │
│                                                                              │
│  3. RabbitMQ Cluster                                                       │
│     • 消息队列                                                             │
│     • 异步处理、服务解耦                                                     │
│     • 3节点镜像队列                                                         │
│     • 高可用消息传递                                                        │
│                                                                              │
│  4. ChromaDB + pgvector                                                     │
│     • 向量数据库                                                           │
│     • 告警嵌入存储、相似检索                                                 │
│     • 2节点 + PostgreSQL持久化                                              │
│                                                                              │
│  5. Elasticsearch Cluster                                                   │
│     • 全文检索                                                             │
│     • 日志检索、告警全文搜索                                                 │
│     • 3节点集群                                                           │
│                                                                              │
│  6. MinIO Distributed                                                      │
│     • 对象存储                                                             │
│     • 证据文件、报表、附件                                                   │
│     • 4节点分布式                                                         │
│     • 纠删码保护                                                           │
│                                                                              │
│  7. TimescaleDB                                                            │
│     • 时序数据库                                                           │
│     • 监控指标、性能数据                                                    │
│     • 2节点(主从)                                                          │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 数据库规格

```
PostgreSQL配置:
- 版本: PostgreSQL 15+
- 节点: 3 (1主2从)
- CPU: 4核/节点
- 内存: 16G/节点
- 存储: 500G SSD (RAID 10)
- 连接池: 100连接
- 备份: 每日全量 + WAL归档

Redis配置:
- 版本: Redis 7+
- 节点: 6 (3主3从)
- CPU: 2核/节点
- 内存: 8G/节点
- 存储: 100G SSD/节点
- 最大内存策略: allkeys-lru
- 持久化: AOF + RDB

RabbitMQ配置:
- 版本: RabbitMQ 3.12+
- 节点: 3
- CPU: 2核/节点
- 内存: 4G/节点
- 存储: 200G SSD/节点
- 队列类型: 镜像队列
- 消息TTL: 7天
```

---

## 3. 监控运维组件

### 3.1 监控栈

```
┌────────────────────────────────────────────────────────────────────────────┐
│                         监控运维组件                                        │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. Prometheus                                                              │
│     • 指标收集和存储                                                        │
│     • 2节点(主从)                                                          │
│     • 30天数据保留                                                         │
│                                                                              │
│  2. Grafana                                                                │
│     • 可视化仪表板                                                         │
│     • 2节点(负载均衡)                                                      │
│     • 预置仪表板模板                                                      │
│                                                                              │
│  3. AlertManager                                                           │
│     • 告警路由和通知                                                       │
│     • 2节点                                                                │
│     • 多级告警抑制                                                         │
│                                                                              │
│  4. Jaeger                                                                 │
│     • 分布式追踪                                                           │
│     • 1节点(可扩展)                                                        │
│     • 7天追踪数据保留                                                      │
│                                                                              │
│  5. ELK Stack                                                              │
│     • 日志聚合和分析                                                       │
│     • 3节点集群                                                           │
│     • 30天日志保留                                                        │
│                                                                              │
│  6. Sentry                                                                 │
│     • 错误追踪                                                             │
│     • 1节点(自托管)                                                        │
│     • 应用异常监控                                                         │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

**文档版本**: v1.0  
**最后更新**: 2025-01-05  
**下一步**: 查看[数据库设计文档](./04_database_design.md)
