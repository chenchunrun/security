# Default values for security-triage
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  # 环境名称
  environment: production

  # 镜像配置
  image:
    registry: ghcr.io
    repository: chenchunrun/security
    pullPolicy: IfNotPresent
    tag: ""

  # 通用标签
  labels: {}

  # 通用注解
  annotations: {}

# 镜像拉取凭据
imagePullSecrets: []
#  - name: ghcr-login-secret

# ========================================
# Stage 1: Core Ingestion Services
# ========================================
alertIngestor:
  enabled: true
  replicaCount: 3

  image:
    repository: alert-ingestor
    tag: "v1.0.0"

  service:
    type: ClusterIP
    port: 8000

  ingress:
    enabled: false
    className: "nginx"
    annotations: {}
    hosts:
    - host: alert-ingestor.example.com
      paths:
      - path: /
        pathType: Prefix
    tls: []

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  # Pod 冲突预算
  podDisruptionBudget:
    enabled: true
    minAvailable: 2

  # 环境变量
  env:
    LOG_LEVEL: "INFO"
    DEBUG: "false"

  # 数据库配置
  database:
    host: postgres-postgresql
    port: 5432
    name: security_triage
    sslMode: require

  # Redis 配置
  redis:
    host: redis-master
    port: 6379
    password: ""
    tlsEnabled: false

  # RabbitMQ 配置
  rabbitmq:
    host: rabbitmq
    port: 5672
    username: admin
    password: ""
    tlsEnabled: false

alertNormalizer:
  enabled: true
  replicaCount: 3
  image:
    repository: alert-normalizer
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  # ... (同 alertIngestor 配置)

# ========================================
# Stage 2: Data Enrichment Services
# ========================================
contextCollector:
  enabled: true
  replicaCount: 2
  image:
    repository: context-collector
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

threatIntelAggregator:
  enabled: true
  replicaCount: 2
  image:
    repository: threat-intel-aggregator
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  # 外部 API 密钥
  env:
    VIRUSTOTAL_API_KEY: ""
    ABUSECH_API_KEY: ""

llmRouter:
  enabled: true
  replicaCount: 2
  image:
    repository: llm-router
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  # MaaS 配置
  env:
    DEEPSEEK_BASE_URL: ""
    DEEPSEEK_API_KEY: ""
    QWEN_BASE_URL: ""
    QWEN_API_KEY: ""

# ========================================
# Stage 3: AI Analysis Services
# ========================================
aiTriageAgent:
  enabled: true
  replicaCount: 3
  image:
    repository: ai-triage-agent
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

similaritySearch:
  enabled: true
  replicaCount: 2
  image:
    repository: similarity-search
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  # ChromaDB 配置
  chromadb:
    host: chromadb
    port: 8000

# ========================================
# Stage 4: Workflow & Automation Services
# ========================================
workflowEngine:
  enabled: true
  replicaCount: 2
  image:
    repository: workflow-engine
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

automationOrchestrator:
  enabled: true
  replicaCount: 2
  image:
    repository: automation-orchestrator
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

notificationService:
  enabled: true
  replicaCount: 2
  image:
    repository: notification-service
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  # 通知渠道配置
  env:
    SMTP_HOST: ""
    SMTP_PORT: "587"
    SMTP_USER: ""
    SMTP_PASSWORD: ""
    SLACK_WEBHOOK_URL: ""

# ========================================
# Stage 5: Support Services & Frontend
# ========================================
dataAnalytics:
  enabled: true
  replicaCount: 2
  image:
    repository: data-analytics
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

reportingService:
  enabled: true
  replicaCount: 2
  image:
    repository: reporting-service
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

configurationService:
  enabled: true
  replicaCount: 2
  image:
    repository: configuration-service
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

monitoringMetrics:
  enabled: true
  replicaCount: 2
  image:
    repository: monitoring-metrics
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  # Prometheus 配置
  prometheus:
    url: "http://prometheus-server"

webDashboard:
  enabled: true
  replicaCount: 3
  image:
    repository: web-dashboard
    tag: "v1.0.0"
  service:
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
    - host: security-triage.example.com
      paths:
      - path: /
        pathType: Prefix
    tls:
    - secretName: security-triage-tls
      hosts:
      - security-triage.example.com

# ========================================
# Infrastructure Services
# ========================================
# PostgreSQL
postgresql:
  enabled: true
  architecture: replication
  primary:
    replicaCount: 1
    resources:
      requests:
        memory: "2Gi"
        cpu: "1000m"
      limits:
        memory: "4Gi"
        cpu: "2000m"
    persistence:
      enabled: true
      size: 100Gi
      storageClass: fast-ssd
  readReplicas:
    replicaCount: 1

# Redis
redis:
  enabled: true
  architecture: standalone
  master:
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"
    persistence:
      enabled: true
      size: 20Gi

# RabbitMQ
rabbitmq:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  persistence:
    enabled: true
    size: 20Gi
  auth:
    username: admin
    password: ""
    erlangCookie: ""

# ChromaDB
chromadb:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"
  persistence:
    enabled: true
    size: 50Gi

# ========================================
# Monitoring & Observability
# ========================================
# Prometheus
prometheus:
  enabled: true
  server:
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"
    persistence:
      enabled: true
      size: 50Gi

# Grafana
grafana:
  enabled: true
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 10Gi
  adminPassword: ""

# ========================================
# Kong API Gateway
# ========================================
kong:
  enabled: true
  replicaCount: 2
  image:
    repository: kong
    tag: "3.5"
  service:
    type: LoadBalancer
    ports:
    - name: proxy
      port: 8000
      targetPort: 8000
    - name: proxy-ssl
      port: 8443
      targetPort: 8443
    - name: admin
      port: 8001
      targetPort: 8001
    - name: admin-ssl
      port: 8444
      targetPort: 8444
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  env:
    KONG_DATABASE: "off"
    KONG_DECLARATIVE_CONFIG: /kong/kong.yml
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
    - host: api.security-triage.example.com
      paths:
      - path: /
        pathType: Prefix
    tls:
    - secretName: kong-proxy-tls
      hosts:
      - api.security-triage.example.com

# ========================================
# 全局配置
# ========================================
# 命名空间
namespace:
  name: security-triage
  create: true

# 服务账户
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod 安全上下文
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# 容器安全上下文
containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
    - ALL
    add:
    - NET_BIND_SERVICE

# 节点选择器
nodeSelector: {}

# 容忍
tolerations: []

# 亲和性
affinity: {}

# Topology Spread Constraints
topologySpreadConstraints: []

# ========================================
# ConfigMaps and Secrets
# ========================================
configMaps:
  app-config:
    enabled: true
    data: {}

secrets:
  database:
    enabled: true
    stringData:
      username: triage_user
      password: ""
      url: ""

  redis:
    enabled: true
    stringData:
      password: ""

  rabbitmq:
    enabled: true
    stringData:
      password: ""

  maas:
    enabled: true
    stringData:
      deepseekApiKey: ""
      qwenApiKey: ""

  threatIntel:
    enabled: true
    stringData:
      virusTotalApiKey: ""
      abusechApiKey: ""

  notification:
    enabled: true
    stringData:
      smtpPassword: ""
      slackWebhookUrl: ""

# ========================================
# 网络策略
# ========================================
networkPolicy:
  enabled: true
  policyTypes:
  - Ingress
  - Egress

# ========================================
# 资源配额
# ========================================
resourceQuota:
  enabled: false
  requests:
    cpu: "10"
    memory: "20Gi"
  limits:
    cpu: "20"
    memory: "40Gi"

# ========================================
# Limit Range
# ========================================
limitRange:
  enabled: true
  default:
    cpu: "500m"
    memory: "512Mi"
  defaultRequest:
    cpu: "250m"
    memory: "256Mi"
  max:
    cpu: "2"
    memory: "4Gi"
  min:
    cpu: "100m"
    memory: "128Mi"
