# Copyright 2026 CCR <chenchunrun@gmail.com>
#
# OpenTelemetry Collector Configuration
# Receives traces and metrics from services and exports to Jaeger

receivers:
  # Metrics
  otlp:
    protocols:
      grpc:
        endpoint: 0.4317
      http:
        endpoint: 0.4318
  prometheus:
    config:
      scrape_configs:
        - job_name: 'otel-collector'
          static_configs:
            - targets: ['localhost:8888']

  # Traces
  jaeger:
    protocols:
      thrift_compact:
        endpoint: jaeger:6831
      thrift_binary:
        endpoint: jaeger:6832

processors:
  batch:
    timeout: 5s
    send_batch_size: 10000

  # Add service name and other resource attributes
  resource:
    attributes:
      service.name: security-triage
      deployment.environment: production
      service.namespace: security-triage

exporters:
  # Metrics to Prometheus
  prometheusremotewrite:
    endpoint: "prometheus:9090/api/v1/write"

  # Traces to Jaeger
  otlp/jaeger:
    endpoint: jaeger:4317
    tls:
      insecure: true

  # Logging
  logging:
    loglevel: info

extensions:
  # Health check
  health_check:
    endpoint: localhost:13133

  # Performance monitoring
  pprof:
    endpoint: localhost:1777

service:
  pipelines:
    metrics:
      receivers: [otlp, prometheus]
      processors: [batch]
      exporters: [prometheusremotewrite]

    traces:
      receivers: [jaeger]
      processors: [batch, resource]
      exporters: [otlp/jaeger]
